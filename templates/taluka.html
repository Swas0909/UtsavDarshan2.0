<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ taluka.name }} Pandals - UtsavDarshan</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
</head>
<body>
    <header>
        <nav>
            <div class="nav-container">
                <h1>UtsavDarshan</h1>
                <a href="{{ url_for('locations') }}" class="btn">Back to Locations</a>
            </div>
        </nav>
    </header>

    <main>
        <section class="taluka-info">
            <h2>Pandals in {{ taluka.name }}</h2>
        </section>

        <section class="map-section">
            <div id="map" style="width: 100%; height: 400px;"></div>
        </section>
    </main>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiZXhhbXBsZSIsImEiOiJjbGV4YW1wbGUifQ.example'; // Replace with your Mapbox access token
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [72.8777, 19.0760], // Default center
            zoom: 10
        });

        const pandals = JSON.parse('{{ taluka.pandals|tojson }}');
        if (pandals.length > 0) {
            const bounds = new mapboxgl.LngLatBounds();
            pandals.forEach(pandal => {
                new mapboxgl.Marker()
                    .setLngLat([pandal.location.lng, pandal.location.lat])
                    .setPopup(new mapboxgl.Popup().setHTML(`<h3>${pandal.name}</h3><p>${pandal.history}</p><a href="/pandal/${pandal.id}">View Details</a>`))
                    .addTo(map);
                bounds.extend([pandal.location.lng, pandal.location.lat]);
            });
            map.fitBounds(bounds, { padding: 20 });
        }
    </script>
</body>
</html>
